{% extends 'base.html' %}

{% block content %}
<title>Python Quiz</title>
<style>
    body {
        background-color: #343a40 !important;
        color: white;
    }

    .quiz-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        border: 1px solid #343a40;
        border-radius: 10px;
        background-color: #1e1e1e;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        position: center !important;
        box-shadow: 0 0 5px green;
    }

    .question {
        font-size: 18px;
        margin-top: 20px;
    }

    .options {
        margin-top: 10px;
    }

    .options label {
        display: block;
        margin-bottom: 10px;
    }
    h2::before {
        content: "Q." attr(data-number) " ";
        font-weight: bold;
    }

    .header {
        display: flex;
    }

    .timer-container {
        font-size: 24px;
        color: white;
        display: inline-block;
        background-color: #343a40;
        padding: 8px 10px;
        border-radius: 5px;
        border: 1px solid !important;
        margin-left: auto;
    }
    .custom-submit-button {
        background-color: black;
        margin: auto;
        color: white;
        padding: 10px 20px;
        border: 1px solid white; /* Set the desired border color */
        border-radius: 15px;
        font-family: 'Montserrat', sans-serif; /* Replace 'Your-Font-Family' with the actual font family you want to use */
        font-size: 15px;
        display: block;
        transition: all 0.3s ease-in-out; /* Add transition for hover effect */
    }

    .custom-submit-button:hover {
        cursor: pointer;
        transform: scale(1.05); /* Add zoom effect on hover */
        box-shadow: 0 0 7px green; /* Add glow effect on hover */
    }

    .answer-input {
        width: 50%;
        padding: 10px;
        border: none;
        background-color: transparent;
        color: white;
        border-radius: 0px;
        font-size: 16px;
        outline: none;
        border-bottom: 1px solid #ccc !important;
        margin-left: 35px;
    }

    .answer-input::placeholder {
        color: white;
        font-family: 'Montserrat', sans-serif;
        font-size: 16px;
    }

</style>
<div class="quiz-container ">
    <div class="header d-flex justify-content-center">
        <h1 class="mb-4 mt-0 title">Python Quiz
            <div class="timer-container mt-3" style="justify-content: :space-between;">
                <span id="minutes">00</span>:<span id="seconds">00</span>
            </div>
        </h1>
    </div>

    <form method="post" onsubmit="return validateForm()">
        {% csrf_token %}
        {% for question in questions %}
        <h2 class="question" data-number="{{ forloop.counter }}">{{ question.question }}</h2>
        {% if question.question_type == 'FIB' %}
        <p><input type="text" name="question_{{ question.uuid }}_input" class="answer-input" autocomplete="off" placeholder="Enter your answer">
            <p /><br>
            {% else %}
        <ul class="options">
            {% for answer in answers %}
            {% if answer.question == question %}
            <li>
                <label>
                    <input type="radio" name="question_{{ question.uuid }}" class="answer-radio"
                        value="{{ answer.uuid }}">
                    {{ answer.answer }}
                </label>
            </li>
            {% endif %}
            {% endfor %}
        </ul><br>
        {% endif %}
        {% endfor %}
        <div class="buttons" style="display:flex;width: 100%;">
            <button class="btn custom-submit-button btn-lg px-5 mx-auto d-block" type="submit">Submit</button>
        </div>        
    </form>
</div>

<script>
    function startTimer() {
        let minutes = {{ timer_minutes|default:5 }} || 5; // Set the quiz time in minutes
        let seconds = {{ timer_seconds|default:0 }} || 0;

        function updateTimer() {
            if (seconds === 0) {
                if (minutes === 0) {
                    clearInterval(timerInterval); // Stop the timer
                    alert("Time is up! Quiz is completed.");
                    window.location.href = "/index";
                } else {
                    minutes--;
                    seconds = 59;
                }
            } else {
                seconds--;
            }

            document.getElementById("minutes").textContent = minutes.toString().padStart(2, "0");
            document.getElementById("seconds").textContent = seconds.toString().padStart(2, "0");
            
        }

        updateTimer(); // Update the timer immediately
        const timerInterval = setInterval(updateTimer, 1000); // Start the timer interval
    }

    const storedMinutes = localStorage.getItem('quizMinutes');
    if (storedMinutes !== null) {
        startTimer();
    } else {
        startTimer(); // Start the timer if no stored state is found
    }

    function validateForm() {
        const answerRadios = document.querySelectorAll('.answer-radio');
        const answerInputs = document.querySelectorAll('.answer-input');
        const answeredQuestions = new Set();

        answerRadios.forEach(radio => {
            if (radio.checked) {
                const questionUuid = radio.name.split('_')[1];
                answeredQuestions.add(questionUuid);
            }
        });

        answerInputs.forEach(input => {
            if (input.value.trim() !== '') {
                const questionUuid = input.name.split('_')[1];
                answeredQuestions.add(questionUuid);
            }
        });

        if (answeredQuestions.size !== {{ total_questions }}) {
        alert("Quiz not completed. Please answer all questions.");
        return false;
    }

    const fibQuestions = document.querySelectorAll('.answer-input');
    fibQuestions.forEach(fibInput => {
        const questionUuid = fibInput.name.split('_')[1];
        const fibRadio = document.querySelector(`input[name="question_${questionUuid}"]:checked`);
        if (!fibRadio) {
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = `question_${questionUuid}`;
            hiddenInput.value = '';
            document.querySelector('form').appendChild(hiddenInput);
        }
    });

    return true;
    }

</script>
{% endblock %}